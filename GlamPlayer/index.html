<!DOCTYPE html>
<html>
  <head>
    <title>Youtube IFrame</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"></meta>
  </head>
  <body style="margin: 0; padding: 0; background: black">
    <div id="player"></div>

    <script>   
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '390',
          width: '640',
          playerVars : {
            enablejsapi: '1',
            origin: 'http://turtlesort.com/'
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
      
      function onPlayerReady(event) {
         
      }

      
      function onPlayerStateChange(event) {
        window.external.OnStateChange(event.data);
      }

      function setFrameSize(width, height){
        player.setSize(width, height);
      }

      var lastPlayedId;
      var fadeInterval;
      var volumeLimit = 100;
      var isShuffled = false;

      function setPlaylist(list){
        var ids = list.split(",");
        player.cuePlaylist(ids);
        isShuffled = false;
      }

      function setSearchPlaylist(searchTerms){
        player.cuePlaylist({
          listType : 'search',
          list : searchTerms
        });
        isShuffled = false;
      }

      function getCurrentVideoUrl(){
        return player.getVideoUrl();
      }

      function start(){
        
        player.playVideo();
        
        if(!isShuffled){
          isShuffled = true;
          player.setShuffle(true);
          player.playVideoAt(0);
        }
 
        player.setLoop(true);        
      }

      function fadeStart(){

        clearInterval(fadeInterval); // stop any existing fade in or fade out

        player.playVideo();

        if(!isShuffled){
          isShuffled = true;
          player.setShuffle(true);
          player.playVideoAt(0); // if we don't call this, it will play the first video of the old, unshuffled order, not the new order
        }

        player.setVolume(0);
        player.setLoop(true); // only seems to work when called after playVideo()

        fadeInterval = setInterval(function(){

          var volume = player.getVolume();

          if(volume == volumeLimit){
            clearInterval(fadeInterval);
          }
          else{
            volume += 5;
            if(volume > volumeLimit){
              volume = volumeLimit;
            }
          }

          player.setVolume(volume);

        },100);
      }

      function pause() {
        player.pauseVideo();
      }

      function fadePause(){
         
          clearInterval(fadeInterval);
          fadeInterval = setInterval(function(){

            var volume = player.getVolume();

            if(volume == 0){
              clearInterval(fadeInterval);
              player.pauseVideo();
            }
            else{
              volume -= 5;
            
              if(volume < 0){
                volume = 0;
              }
            }
            
            player.setVolume(volume);
            
          },50); 

      }

    </script>
  </body>
</html>